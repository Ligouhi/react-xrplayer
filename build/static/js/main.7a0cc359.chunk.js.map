{"version":3,"sources":["redux/basic.redux.js","controls/DeviceOrientationControls.js","controls/InnerViewControls.js","display/SpriteShapeHelper.js","const/PanoConst.js","effect/EffectInfoCard.jsx","effect/EffectImageCard.jsx","effect/EffectVideoPanel.jsx","effect/EffectControlPanel.jsx","effect/EffectContainer.jsx","display/loader/FBXLoader.js","display/loader/ObjLoader.js","display/CenterModelHelper.js","action/CameraMoveAction.js","action/ViewConvertHelper.js","utils/fullscreen.js","texture/TextureHelper.js","Player.js","reducer.js","store.js","webpack:///./src/index.js?b635","../example/src/app.js","../example/src/index.js"],"names":["initialState","live_configure","DeviceOrientationControls","camera","event","deviceOrientation","screenOrientation","window","orientation","alpha0","addEventListener","onScreenOrientationChangeEvent","onDeviceOrientationChangeEvent","enabled","removeEventListener","distance","alpha","THREE","degToRad","alphaOffset","beta","gamma","orient","zee","q0","q1","Math","sqrt","euler","set","quaternion","setFromEuler","multiply","setFromAxisAngle","cameraDirtection","getWorldDirection","multiplyScalar","position","copy","this","InnerViewControls","isConnected","initSphericalData","spherical","setFromCartesianCoords","x","y","z","phi","theta","radius","lon","radToDeg","lat","browser","navigator","userAgent","toLowerCase","indexOf","document","onTouchstart","onTouchmove","onTouchend","onDocumentMouseWheel","onDocumentMouseDown","onDocumentMouseMove","onDocumentMouseUp","onDocumentKeyDown","onDocumentKeyUp","updateGUI","lookAt","target","updateCameraPosition","orientationEnable","control","orientationControl","connectOrientationControls","disconnectOrientationControls","dLon","dLat","onKeyShift","onKeyLeft","onKeyRight","onKeyUp","onKeyDown","max","min","sin","cos","orientationControls","update","pointerLockElement","preventDefault","console","log","isUserInteracting","onPointerDownPointerX","clientX","onPointerDownPointerY","clientY","onPointerDownLon","onPointerDownLat","movementX","movementY","targetTouches","length","touch","pageX","pageY","parseFloat","deltaY","innerView","keyCode","which","charCode","exitPointerLock","body","requestPointerLock","connect","disConnect","onMouseDownMouseX","onMouseDownMouseY","onMouseDownLon","onMouseDownLat","initControlsListener","gui","dat","add","step","SpriteShapeHelper","scene","list","pointList","initPoints","pointGroup","pointArr","forEach","point","createPoint","bindEvent","url","opacity","scale","texture","load","needsUpdate","material","map","transparent","depthTest","mesh","color","canvas","createElement","getElementById","appendChild","width","height","ctx","getContext","fillStyle","arc","PI","fill","meshGroup","t","children","item","tweenA","TWEEN","Tween","to","delay","tweenB","chain","start","raycaster","mouse","innerWidth","innerHeight","setFromCamera","intersects","intersectObjects","objectClickHandler","contertSph2Rect","name","createSpriteShape","getBackgroundTexture","push","animatePoints","EffectInfoCard","e","props","onCloseClickHandler","className","iframeUrl","loading","allow","display","onClick","onCloseClickListener","Component","propTypes","PropTypes","func","isRequired","string","EffectImageCard","jumpUrl","open","imageUrl","onImageClickListenr","src","alt","EffectVideoPanel","video","videoUrl","play","Hls","isSupported","hls","loadSource","attachMedia","on","Events","MANIFEST_PARSED","alert","videoNode","loop","muted","setAttribute","endsWith","loadMp4Video","loadHlsVideo","destroy","controls","ref","mount","EffectControlPanel","EffectContainer","infocard_visible","data","type","showEffect","getEffect","object","MyFBXLoader","FBXLoader","objUrl","obj","translateY","startAnimation","loaded","ambient","remove","mixer","animationAction","clipAction","animations","stop","delta","clock","getDelta","ObjLoader","geometry","center","CenterModelHelper","model_list","loader","getLoader","modelMap","loadObj","modeFormat","stopAnimation","Map","CameraMoveAction","endState","duration","coords","fov","tween","easing","Easing","Quadratic","Out","onUpdate","updateProjectionMatrix","onStart","onStartHandler","onComplete","onCompleteHandler","init","ViewConvertHelper","durtime","state","cameraMoveAction","FullScreen","detectFullScreen","bind","fscreen","handleProps","fullscreenElement","node","leaveFullScreen","enterFullScreen","onChange","fullscreenEnabled","requestFullscreen","exitFullscreen","style","undefined","bool","TextureHelper","containerNode","crossOrigin","minFilter","format","resUrl","initVideoNode","flvjs","flvPlayer","createPlayer","videoLoader","attachMediaElement","error","onLoadErrorHandler","getTextureFromVideo","onLoadSuccessHandler","resource","res_url","loadFlvVideo","loadImage","unload","detachMediaElement","destory","XRPlayer","showingEffect","effectData","isFullScreen","camera_fov","camera_far","camera_near","camera_position","camera_target","clientWidth","clientHeight","renderer","antialias","textureResource","scene_texture_resource","isAxesHelperDisplay","axes_helper_display","sceneContainer","loadTexture","axisHelper","onWindowResize","event_list","hot_spot_list","spriteData","spriteShapeHelper","setPointList","key","has","setState","get","centerModelHelper","loadModelList","viewConvertHelper","innerViewControls","toNormalView","aspect","setSize","setPixelRatio","devicePixelRatio","sortObjects","autoClear","domElement","requestAnimationFrame","animate","render","initScene","initCamera","initEvent","initControls","initDisplay","initRenderer","initAction","fetchLiveConfigure","removeChild","isFull","background","overflow","id","protoTypes","Proptypes","number","array","defaultProps","basic","channel_id","dispatch","axios","then","res","code","payload","liveConfigureAction","rootReducer","combineReducers","action","store","createStore","compose","applyMiddleware","thunk","devToolsExtension","f","Player","React","App","ReactDOM"],"mappings":"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","file":"static/js/main.7a0cc359.chunk.js","sourcesContent":["import axios from 'axios';\r\n\r\n// Action Types\r\nconst GET_LIVE_CONFIGURE = \"GET_LIVE_CONFIGURE\";\r\n\r\n// 初始state中的数据\r\nconst initialState = {\r\n    live_configure: \"\"\r\n}\r\n\r\n//reducer, 根据action对state进行处理，返回新的state\r\nexport function basic(state = initialState, action) {\r\n    switch (action.type) {\r\n        case GET_LIVE_CONFIGURE:\r\n            return { ...state, live_configure: action.payload };\r\n        default: return state;\r\n    }\r\n}\r\n\r\n//actionCreator， 创建action对象\r\nfunction liveConfigureAction(data) {\r\n    return {\r\n        payload: data,\r\n        type: GET_LIVE_CONFIGURE\r\n    }\r\n}\r\n\r\n//在组件中调用的dispatch action的函数\r\nexport function fetchLiveConfigure(channel_id) {\r\n    return dispatch => {\r\n        axios.get(`http://114.116.180.115:9000/channel/info/?lid=lc205`).then(res => {\r\n            let data = res.data;\r\n            if (data.code === 200) {\r\n                dispatch(liveConfigureAction(data.data))\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\n\r\n","import * as THREE from 'three';\r\n\r\nclass DeviceOrientationControls {\r\n\r\n    constructor(camera) {\r\n        this.camera = camera;\r\n        this.enabled = false;\r\n        this.deviceOrientation = {\r\n            alpha: 0,\r\n            beta: 90,\r\n            gamma: 0\r\n        };\r\n        this.screenOrientation = 0;\r\n        this.alphaOffset = 0;\r\n    }\r\n\r\n    onDeviceOrientationChangeEvent = (event) => {\r\n        this.deviceOrientation = event;\r\n    };\r\n\r\n    onScreenOrientationChangeEvent = () => {\r\n        this.screenOrientation = window.orientation || 0;\r\n    };\r\n\r\n    connect = (alpha0) => {\r\n        window.addEventListener('orientationchange', this.onScreenOrientationChangeEvent, false);\r\n        window.addEventListener('deviceorientation', this.onDeviceOrientationChangeEvent, false);\r\n        this.onScreenOrientationChangeEvent(); // run once on load\r\n        this.enabled = true;\r\n    };\r\n\r\n    disConnect = () => {\r\n        this.enabled = false;\r\n        window.removeEventListener('orientationchange', this.onScreenOrientationChangeEvent, false);\r\n        window.removeEventListener('deviceorientation', this.onDeviceOrientationChangeEvent, false);\r\n    };\r\n\r\n    update = (distance) => {\r\n        if (this.enabled === false) return;\r\n        // get data from device\r\n        var alpha = this.deviceOrientation.alpha ?\r\n            THREE.Math.degToRad(this.deviceOrientation.alpha) : 0; // Z\r\n        alpha -= this.alphaOffset;\r\n        var beta = this.deviceOrientation.beta ?\r\n            THREE.Math.degToRad(this.deviceOrientation.beta) : 0; // X\r\n        var gamma = this.deviceOrientation.gamma ?\r\n            THREE.Math.degToRad(this.deviceOrientation.gamma) : 0; // Y\r\n        var orient = this.screenOrientation ?\r\n            THREE.Math.degToRad(this.screenOrientation) : 0; // Orient\r\n\r\n        var zee = new THREE.Vector3(0, 0, 1);\r\n        var q0 = new THREE.Quaternion(); // Quaternions are used in three.js to represent rotations.\r\n        var q1 = new THREE.Quaternion(- Math.sqrt(0.5), 0, 0, Math.sqrt(0.5)); // - PI/2 around the x-axis\r\n        var euler = new THREE.Euler(); // 欧拉对象，描述xyz轴上的一个旋转序列\r\n        euler.set(beta, alpha, - gamma, 'YXZ'); // 'ZXY' for the device, but 'YXZ' for us\r\n        this.camera.quaternion.setFromEuler(euler);    // 设置旋转角度\r\n        this.camera.quaternion.multiply(q1); // 执行方位角的转换 \r\n        this.camera.quaternion.multiply(q0.setFromAxisAngle(zee, - orient));    // 横竖屏切换旋转\r\n\r\n        // TODO distance同步视野大小,暂时先这么解决，澄亮正改用通过fov参数控制视野方案\r\n        var cameraDirtection = new THREE.Vector3(0, 0, 0);\r\n        this.camera.getWorldDirection(cameraDirtection);\r\n        cameraDirtection.multiplyScalar(-distance);\r\n        this.camera.position.copy(cameraDirtection);\r\n        this.camera.quaternion.copy(this.camera.quaternion);\r\n    };\r\n\r\n    getDataFromDevice = () => {\r\n\r\n    }\r\n\r\n}\r\n\r\nexport default DeviceOrientationControls;","/**\r\n * 在球体中的全景视角控制\r\n * Three.js自带的Controls控制效果不理想，所以自己实现控制器\r\n */\r\nimport * as THREE from 'three';\r\nimport DeviceOrientationControls from './DeviceOrientationControls';\r\nimport * as dat from 'dat.gui';\r\n\r\n\r\nclass InnerViewControls {\r\n\r\n    constructor(camera) {\r\n        this.camera = camera;\r\n        this.isConnected = false;\r\n        this.isUserInteracting = false;     // 标记用户是否正在交互中\r\n        this.onMouseDownMouseX = 0;         // 鼠标点击的初始坐标x\r\n        this.onMouseDownMouseY = 0;         // 鼠标点击的初始坐标y\r\n        this.lon = 0;                       // 经度\r\n        this.onMouseDownLon = 0;\r\n        this.lat = 0;                       // 纬度\r\n        this.onMouseDownLat = 0;\r\n        this.phi = 0;\r\n        this.theta = 0;\r\n        this.distance = 10;\r\n        this.onPointerDownPointerX = 0;\r\n        this.onPointerDownPointerY = 0;\r\n        this.onPointerDownLon = 0;\r\n        this.onPointerDownLat = 0;\r\n\r\n        //键盘交互控件\r\n        this.onKeyLeft = false;\r\n        this.onKeyRight = false;\r\n        this.onKeyUp = false;\r\n        this.onKeyDown = false;\r\n        this.onKeyShift = false;\r\n\r\n        this.initControlsListener();\r\n\r\n        //重力交互控件\r\n        this.orientationControls = new DeviceOrientationControls(this.camera);\r\n        this.orientationEnable = false;\r\n\r\n        //GUI\r\n        var gui = new dat.GUI();\r\n        this.control = new function () {\r\n            this.orientationControl = 0;\r\n        }();\r\n        gui.add(this.control, 'orientationControl', 0, 1).step(1);\r\n    }\r\n\r\n    /**\r\n     * 相机与控制器连接，数据生效\r\n     */\r\n    connect = () => {\r\n        this.isConnected = true;\r\n        this.initSphericalData();\r\n    };\r\n\r\n    disConnect = () => {\r\n        this.isConnected = false;\r\n    };\r\n\r\n    // 将初始化的直角坐标转化为控制所需要的球体坐标数据\r\n    initSphericalData = () => {\r\n        const spherical = new THREE.Spherical();\r\n        const position = this.camera.position;\r\n        spherical.setFromCartesianCoords(position.x, position.y, position.z);\r\n        this.phi = spherical.phi;\r\n        this.theta = spherical.theta;\r\n        this.distance = spherical.radius;\r\n        this.lon = 90 - THREE.Math.radToDeg(this.theta);\r\n        this.lat = 90 - THREE.Math.radToDeg(this.phi);\r\n    };\r\n\r\n    initControlsListener = () => {\r\n        this.browser = window.navigator.userAgent.toLowerCase();\r\n        if (this.browser.indexOf('mobile') > 0) {\r\n            document.addEventListener('touchstart', this.onTouchstart, false);\r\n            document.addEventListener('touchmove', this.onTouchmove, false);\r\n            document.addEventListener('touchend', this.onTouchend, false);\r\n            document.addEventListener('wheel', this.onDocumentMouseWheel, false);\r\n        } else {\r\n            document.addEventListener('mousedown', this.onDocumentMouseDown, false);\r\n            document.addEventListener('mousemove', this.onDocumentMouseMove, false);\r\n            document.addEventListener('mouseup', this.onDocumentMouseUp, false);\r\n            document.addEventListener('wheel', this.onDocumentMouseWheel, false);\r\n            //添加键盘监听\r\n            document.addEventListener('keydown', this.onDocumentKeyDown, false);\r\n            document.addEventListener('keyup', this.onDocumentKeyUp, false);\r\n        }\r\n    };\r\n\r\n    update = () => {\r\n        this.updateGUI();\r\n        this.camera.lookAt(this.camera.target);\r\n        if (!this.isConnected) return;\r\n        this.updateCameraPosition();\r\n    };\r\n\r\n    updateGUI = () => {\r\n        if (this.orientationEnable === false && this.control.orientationControl >= 1) {\r\n            this.connectOrientationControls();\r\n        }\r\n        if (this.orientationEnable === true && this.control.orientationControl < 1) {\r\n            this.disconnectOrientationControls();\r\n        }\r\n    };\r\n\r\n    updateCameraPosition = () => {\r\n        if (this.orientationEnable === true) {\r\n            this.orientationControls.update(this.distance);\r\n            return;\r\n        }\r\n        var dLon = 2;\r\n        var dLat = 2;\r\n        if (this.onKeyShift) {\r\n            dLon = 10;\r\n            dLat = 10;\r\n        }\r\n        if (this.onKeyLeft) {\r\n            this.lon -= dLon;\r\n        }\r\n        if (this.onKeyRight) {\r\n            this.lon += dLon;\r\n        }\r\n        if (this.onKeyUp) {\r\n            this.lat -= dLat;\r\n        }\r\n        if (this.onKeyDown) {\r\n            this.lat += dLat;\r\n        }\r\n        this.lat = Math.max(- 85, Math.min(85, this.lat));\r\n        this.phi = THREE.Math.degToRad(90 - this.lat);\r\n        this.theta = THREE.Math.degToRad(this.lon);\r\n        // 球坐标系与直角坐标系的转换\r\n        this.camera.position.x = this.distance * Math.sin(this.phi) * Math.cos(this.theta);\r\n        this.camera.position.y = this.distance * Math.cos(this.phi);\r\n        this.camera.position.z = this.distance * Math.sin(this.phi) * Math.sin(this.theta);\r\n    };\r\n\r\n    onDocumentMouseDown = (event) => {\r\n        if (!!document.pointerLockElement) {\r\n            return;\r\n        }\r\n        event.preventDefault();\r\n        console.log('鼠标点击Down')\r\n        this.isUserInteracting = true;\r\n        // 记录鼠标点击屏幕坐标\r\n        this.onPointerDownPointerX = event.clientX;\r\n        this.onPointerDownPointerY = event.clientY;\r\n        // 记录点击时候经纬度\r\n        this.onPointerDownLon = this.lon; // 经度\r\n        this.onPointerDownLat = this.lat; // 纬度\r\n    }\r\n\r\n    onDocumentMouseMove = (event) => {\r\n        if (this.isUserInteracting === true) {\r\n            // 在鼠标Down位置叠加偏移量\r\n            this.lon = (this.onPointerDownPointerX - event.clientX) * 0.1 + this.onPointerDownLon;\r\n            this.lat = (this.onPointerDownPointerY - event.clientY) * 0.1 + this.onPointerDownLat;\r\n            // 用于立体场景音效\r\n            // mouseActionLocal([lon, lat]);\r\n        }\r\n        if (!!document.pointerLockElement) {\r\n            this.lon = event.movementX * 0.1 + this.lon;\r\n            this.lat = event.movementY * 0.1 + this.lat;\r\n        }\r\n    }\r\n\r\n    onDocumentMouseUp = (event) => {\r\n        this.isUserInteracting = false;\r\n    }\r\n\r\n    onTouchstart = (event) => {\r\n        if (event.targetTouches.length === 1) {\r\n            console.log('touch', 'start');\r\n            this.isUserInteracting = true;\r\n            // 记录滑动开始的坐标\r\n            var touch = event.targetTouches[0];\r\n            this.onPointerDownPointerX = touch.pageX; // 把元素放在手指所在的位置\r\n            this.onPointerDownPointerY = touch.pageY;\r\n            // 记录滑动开始时候的经纬度\r\n            this.onPointerDownLon = this.lon; // 经度\r\n            this.onPointerDownLat = this.lat; // 纬度\r\n        }\r\n    }\r\n\r\n    onTouchmove = (event) => {\r\n        if (this.isUserInteracting === true) {\r\n            var touch = event.targetTouches[0];\r\n            console.log('touching', touch.pageX);\r\n            this.lon = (parseFloat(this.onPointerDownPointerX) - touch.pageX) * 0.1 + this.onPointerDownLon;\r\n            this.lat = (parseFloat(this.onPointerDownPointerY - touch.pageY)) * 0.1 + this.onPointerDownLat;\r\n            // 用于立体场景音效\r\n            // mouseActionLocal([lon, lat]);\r\n        }\r\n    }\r\n\r\n    onTouchend = (event) => {\r\n        this.isUserInteracting = false;\r\n    }\r\n\r\n    onDocumentMouseWheel = (event) => {\r\n        this.distance += event.deltaY * 0.5;\r\n        if (this.distance <= 0) {\r\n            this.distance = 0;\r\n        } else if (this.distance > 0 && this.distance < 1000) {\r\n            if (!this.innerView) {\r\n                console.log('进来', this.camera.position.y)\r\n                this.innerView = true;\r\n            }\r\n        }\r\n        else if (this.distance >= 1000 && this.distance <= 1500) {\r\n            if (this.innerView) {\r\n                console.log('出来')\r\n                this.innerView = false;\r\n            }\r\n        }\r\n        else if (this.distance >= 1500) {\r\n            //this.distance = 1500;\r\n        }\r\n        console.log('distance', this.distance);\r\n\r\n    }\r\n\r\n    onDocumentKeyDown = (event) => {\r\n        event.preventDefault();\r\n        var keyCode = event.keyCode || event.which || event.charCode;\r\n        switch (keyCode) {\r\n\r\n            case 65: /*a*/\r\n            case 37: /*left*/ this.onKeyLeft = true; this.onKeyRight = false; break;\r\n\r\n            case 68: /*d*/\r\n            case 39: /*right*/ this.onKeyRight = true; this.onKeyLeft = false; break;\r\n\r\n            case 87: /*w*/\r\n            case 38: /*up*/ this.onKeyUp = true; this.onKeyDown = false; break;\r\n\r\n            case 83: /*s*/\r\n            case 40: /*down*/ this.onKeyDown = true; this.onKeyUp = false; break;\r\n\r\n            case 16: /*Shift*/ this.onKeyShift = true; break;\r\n\r\n            case 81: /*q*/\r\n                if (!!document.pointerLockElement) {\r\n                    document.exitPointerLock();\r\n                }\r\n                else {\r\n                    document.body.requestPointerLock();\r\n                    this.isUserInteracting = false;\r\n                }\r\n                break;\r\n\r\n            case 82: /*r*/\r\n                console.log('alphaOffset = ' + THREE.MathUtils.radToDeg(this.orientationControls.alphaOffset));\r\n                console.log('lon = ' + this.lon);\r\n                console.log('dO.alpha = ' + this.orientationControls.deviceOrientation.alpha);\r\n                break;\r\n\r\n            default: break;\r\n\r\n        }\r\n    }\r\n\r\n    onDocumentKeyUp = (event) => {\r\n        var keyCode = event.keyCode || event.which || event.charCode;\r\n        switch (keyCode) {\r\n\r\n            case 65: /*a*/\r\n            case 37: /*left*/ this.onKeyLeft = false; break;\r\n\r\n            case 68: /*d*/\r\n            case 39: /*right*/ this.onKeyRight = false; break;\r\n\r\n            case 87: /*w*/\r\n            case 38: /*up*/ this.onKeyUp = false; break;\r\n\r\n            case 83: /*s*/\r\n            case 40: /*down*/ this.onKeyDown = false; break;\r\n\r\n            case 16: /*L_Shift*/ this.onKeyShift = false; break;\r\n\r\n            default: break;\r\n\r\n        }\r\n    };\r\n\r\n    connectOrientationControls = () => {\r\n        this.orientationControls.connect(THREE.MathUtils.degToRad(this.lon - 90));\r\n        this.orientationEnable = true;\r\n    };\r\n\r\n    disconnectOrientationControls = () => {\r\n        this.orientationControls.disConnect();\r\n        this.orientationEnable = false;\r\n        this.initSphericalData();\r\n    };\r\n\r\n}\r\n\r\nexport default InnerViewControls;","/**\r\n * 向3D场景中添加可以交互的热点标签或者按钮\r\n */\r\nimport * as THREE from 'three';\r\nimport { Radius } from '../const/PanoConst';\r\nimport TWEEN from '@tweenjs/tween.js';\r\n\r\nclass SpriteShapeHelper {\r\n\r\n    constructor(scene, camera) {\r\n        this.scene = scene;\r\n        this.camera = camera;\r\n        this.pointList = [];\r\n        this.pointGroup = null;\r\n\r\n        this.objectClickHandler = null;\r\n    }\r\n\r\n    setPointList = (list) => {\r\n        this.pointList = list;\r\n        this.initPoints();\r\n    }\r\n\r\n    initPoints = () => {\r\n        this.pointGroup = new THREE.Group();\r\n        this.pointArr = [];\r\n        this.pointList.forEach((point) => {\r\n            this.createPoint(point)\r\n        });\r\n        this.scene.add(this.pointGroup);\r\n        this.bindEvent();\r\n    }\r\n\r\n    contertSph2Rect = (phi, theta) => {\r\n        let r = Radius;\r\n        return [\r\n            r * Math.sin(THREE.Math.degToRad(phi)) * Math.cos(THREE.Math.degToRad(theta)),\r\n            r * Math.sin(THREE.Math.degToRad(phi)) * Math.sin(THREE.Math.degToRad(theta)),\r\n            r * Math.cos(THREE.Math.degToRad(phi))\r\n        ];\r\n    }\r\n\r\n    createPoint(point) {\r\n        let position = this.contertSph2Rect(point[1].phi, point[1].theta);\r\n        let meshGroup = new THREE.Group();\r\n        meshGroup.name = point[0];\r\n        meshGroup.position.set(...position);\r\n\r\n        let mesh = this.createSpriteShape(\"hotspot_video.png\", 1, 16);\r\n        meshGroup.add(mesh);\r\n        mesh = this.getBackgroundTexture('#2d2d2d', 0.2, 20);\r\n        meshGroup.add(mesh);\r\n        this.pointArr.push(mesh);\r\n        mesh.name = point[0];\r\n        this.pointGroup.add(meshGroup);\r\n        this.animatePoints(meshGroup);\r\n    }\r\n\r\n    createSpriteShape = (url, opacity, scale) => {\r\n        let texture = new THREE.TextureLoader().load(url);\r\n        texture.needsUpdate = true; //注意这句不能少\r\n        let material = new THREE.SpriteMaterial({\r\n            map: texture,\r\n            transparent: true,\r\n            opacity: opacity,\r\n            depthTest: false\r\n        });\r\n        let mesh = new THREE.Sprite(material);\r\n        mesh.scale.set(scale * 2, scale * 2, 1);\r\n        return mesh;\r\n    }\r\n\r\n    getBackgroundTexture = (color, opacity, scale) => {\r\n        let canvas = document.createElement(\"canvas\");\r\n        const container = document.getElementById('display')\r\n        container.appendChild(canvas);\r\n        canvas.width = 128;\r\n        canvas.height = 128;\r\n        let ctx = canvas.getContext(\"2d\");\r\n        ctx.fillStyle = color;\r\n        ctx.arc(64, 64, 64, 0, 2 * Math.PI);\r\n        ctx.fill();\r\n        let texture = new THREE.Texture(canvas);\r\n        texture.needsUpdate = true; //注意这句不能少\r\n        let material = new THREE.SpriteMaterial({\r\n            map: texture,\r\n            transparent: true,\r\n            opacity: opacity,\r\n            depthTest: false\r\n        });\r\n        let mesh = new THREE.Sprite(material);\r\n        mesh.scale.set(scale * 2, scale * 2, 1);\r\n        return mesh;\r\n    }\r\n\r\n    animatePoints = (meshGroup) => {\r\n        let t = 300;\r\n        meshGroup.children.forEach(item => {\r\n            let scale = item.scale;\r\n            let tweenA = new TWEEN.Tween(scale)\r\n                .to({ x: scale.x * 0.8, y: scale.y * 0.8 }, 500)\r\n                .delay(100)\r\n            let tweenB = new TWEEN.Tween(scale)\r\n                .to({ x: scale.x * 1.2, y: scale.y * 1.2 }, 500)\r\n                .delay(100)\r\n            tweenA.chain(tweenB);\r\n            tweenB.chain(tweenA);\r\n            tweenA.start(t = t + 100);\r\n        })\r\n    }\r\n\r\n    update = () => {\r\n        TWEEN.update();\r\n    }\r\n\r\n    bindEvent = () => {\r\n        let raycaster = new THREE.Raycaster();\r\n        document.addEventListener('click', (event) => {\r\n            event.preventDefault();\r\n            let mouse = new THREE.Vector2();\r\n            //通过鼠标点击的位置计算出raycaster所需要的点的位置，以屏幕中心为原点，值的范围为-1到1.\r\n            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\r\n            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;\r\n            // 通过鼠标点的位置和当前相机的矩阵计算出raycaster\r\n            raycaster.setFromCamera(mouse, this.camera);\r\n            // 获取raycaster直线和所有模型相交的数组集合\r\n            var intersects = raycaster.intersectObjects(this.pointArr);\r\n            //如果只需要将第一个触发事件，那就取数组的第一个模型\r\n            if (intersects.length > 0) {\r\n                //this.showModal(intersects[0].object.name)\r\n                if (this.objectClickHandler) {\r\n                    this.objectClickHandler(intersects);\r\n                }\r\n            }\r\n        }, true);\r\n    }\r\n}\r\n\r\nexport default SpriteShapeHelper;","/**\r\n * 全景球体的半径\r\n */\r\nexport const Radius = 500; ","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Iframe from 'react-iframe'\r\nimport '../style/EffectInfoCard.less';\r\n\r\nclass EffectInfoCard extends Component {\r\n\r\n    onCloseClickListener = (e) => {\r\n        e.preventDefault();\r\n        if (this.props.onCloseClickHandler) {\r\n            this.props.onCloseClickHandler();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"overlay\">\r\n                <Iframe\r\n                    url={this.props.iframeUrl}\r\n                    className=\"iframe\"\r\n                    loading='true'\r\n                    allow=\"fullscreen\"\r\n                    display=\"initial\" />\r\n\r\n                <div\r\n                    className=\"close\"\r\n                    onClick={this.onCloseClickListener}\r\n                ></div>\r\n            </div>)\r\n    }\r\n}\r\n\r\nEffectInfoCard.propTypes = {\r\n    onCloseClickHandler: PropTypes.func.isRequired,\r\n    iframeUrl: PropTypes.string.isRequired\r\n};\r\n\r\nexport default EffectInfoCard;\r\n\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport '../style/EffectImageCard.less';\r\n\r\nclass EffectImageCard extends Component {\r\n\r\n    onCloseClickListener = (e) => {\r\n        e.preventDefault();\r\n        if (this.props.onCloseClickHandler) {\r\n            this.props.onCloseClickHandler();\r\n        }\r\n    }\r\n\r\n    onImageClickListenr = (e) => {\r\n        e.preventDefault();\r\n        if (this.props.jumpUrl) {\r\n            window.open(this.props.jumpUrl, '_blank');\r\n        }\r\n    }\r\n\r\n    render() {\r\n        console.log('imageurl', this.props.imageUrl);\r\n        return (\r\n            <div className=\"overlay\">\r\n                <div className=\"container\">\r\n                    <img\r\n                        className=\"image\"\r\n                        onClick={this.onImageClickListenr}\r\n                        src={this.props.imageUrl}\r\n                        alt=\"\"></img>\r\n                </div>\r\n                <div\r\n                    className=\"close\"\r\n                    onClick={this.onCloseClickListener}\r\n                ></div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nEffectImageCard.propTypes = {\r\n    onCloseClickHandler: PropTypes.func.isRequired,\r\n    imageUrl: PropTypes.string.isRequired,\r\n    jumpUrl: PropTypes.string,\r\n};\r\n\r\nexport default EffectImageCard;\r\n\r\n","/**\r\n * 弹窗视频效果\r\n */\r\nimport React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport '../style/EffectVideoPanel.less';\r\nimport Hls from 'hls.js';\r\n\r\n\r\nclass EffectVideoPanel extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.hls = null;\r\n        this.video = null;\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.hls = new Hls();\r\n        this.video = this.videoNode;\r\n        this.video.loop = true;\r\n        this.video.muted = true;\r\n        console.log('videoUrl', this.props.videoUrl);\r\n        this.video.setAttribute('webkit-playsinline', 'webkit-playsinline');\r\n        const videoUrl = this.props.videoUrl;\r\n        if (videoUrl.endsWith('.mp4')) {\r\n            this.loadMp4Video();\r\n        } else if (videoUrl.endsWith('.m3u8')) {\r\n            this.loadHlsVideo();\r\n        }\r\n\r\n    }\r\n\r\n    loadMp4Video = () => {\r\n        this.video.src = this.props.videoUrl;\r\n        this.video.play();\r\n    }\r\n\r\n    loadHlsVideo = () => {\r\n        if (Hls.isSupported()) {\r\n            console.log('hls', 'support');\r\n            this.hls.loadSource(this.props.videoUrl);\r\n            this.hls.attachMedia(this.video);\r\n            this.hls.on(Hls.Events.MANIFEST_PARSED, () => {\r\n                this.video.play();\r\n                console.log('videoplay');\r\n            });\r\n        } else {\r\n            console.log('设备不支持')\r\n            alert(\"设备不支持\");\r\n        }\r\n    }\r\n\r\n    onCloseClickListener = (e) => {\r\n        e.preventDefault();\r\n        if (this.props.onCloseClickHandler) {\r\n            this.props.onCloseClickHandler();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.hls.destroy();\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"overlay\">\r\n\r\n                <div className=\"container \">\r\n                    <video\r\n                        className=\"video\"\r\n                        controls\r\n                        ref={(mount) => { this.videoNode = mount }}\r\n                    ></video>\r\n                </div>\r\n                <div\r\n                    className=\"close\"\r\n                    onClick={this.onCloseClickListener}\r\n                ></div>\r\n            </div>)\r\n    }\r\n}\r\n\r\nEffectVideoPanel.propTypes = {\r\n    onCloseClickHandler: PropTypes.func.isRequired,\r\n    videoUrl: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default EffectVideoPanel;\r\n\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport '../style/EffectControlPanel.less';\r\n\r\nclass EffectControlPanel extends Component {\r\n\r\n    componentDidMount() {\r\n    }\r\n\r\n    onCloseClickListener = (e) => {\r\n        e.preventDefault();\r\n        if (this.props.onCloseClickHandler) {\r\n            this.props.onCloseClickHandler();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"overlay\">\r\n                <div className=\"control-container \">\r\n\r\n                    <button>控制面板</button>\r\n                </div>\r\n                <div\r\n                    className=\"close\"\r\n                    onClick={this.onCloseClickListener}\r\n                ></div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nEffectControlPanel.propTypes = {\r\n    onCloseClickHandler: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default EffectControlPanel;\r\n\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport EffectInfoCard from './EffectInfoCard';\r\nimport EffectImageCard from './EffectImageCard';\r\nimport EffectVideoPanel from './EffectVideoPanel';\r\nimport EffectControlPanel from './EffectControlPanel';\r\n\r\nclass EffectContainer extends Component {\r\n\r\n    state = {\r\n        infocard_visible: false\r\n    }\r\n\r\n    getEffect = (data) => {\r\n        if (!data) {\r\n            return \"\";\r\n        }\r\n        if (data.type === 'infocard') {\r\n            return (\r\n                <EffectInfoCard\r\n                    onCloseClickHandler={() => {\r\n                        this.props.onCloseClickHandler && this.props.onCloseClickHandler();\r\n                    }}\r\n                    iframeUrl={data.iframeUrl}\r\n                ></EffectInfoCard>\r\n            )\r\n        } else if (data.type === 'image') {\r\n            return (\r\n                <EffectImageCard\r\n                    onCloseClickHandler={() => {\r\n                        this.props.onCloseClickHandler && this.props.onCloseClickHandler();\r\n                    }}\r\n                    imageUrl={data.imageUrl}\r\n                    jumpUrl={data.jumpUrl}\r\n                ></EffectImageCard>\r\n            )\r\n        } else if (data.type === 'video') {\r\n            return (\r\n                <EffectVideoPanel\r\n                    onCloseClickHandler={() => {\r\n                        this.props.onCloseClickHandler && this.props.onCloseClickHandler();\r\n                    }}\r\n                    videoUrl={data.videoUrl}\r\n                ></EffectVideoPanel>\r\n            )\r\n        } else if (data.type === 'control') {\r\n            return (\r\n                <EffectControlPanel\r\n                    onCloseClickHandler={() => {\r\n                        this.props.onCloseClickHandler && this.props.onCloseClickHandler();\r\n                    }}\r\n                ></EffectControlPanel>\r\n            )\r\n        }\r\n        else {\r\n            return \"\"\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const showEffect = this.getEffect(this.props.data);\r\n        return (\r\n            <div >\r\n                {\r\n                    showEffect\r\n                }\r\n            </div>)\r\n    }\r\n}\r\n\r\nEffectContainer.propTypes = {\r\n    data: PropTypes.object,\r\n    onCloseClickHandler: PropTypes.func.isRequired\r\n}\r\n\r\nexport default EffectContainer;\r\n\r\n","import * as THREE from 'three';\r\nimport FBXLoader from 'three-fbxloader-offical';\r\n\r\n\r\nclass MyFBXLoader {\r\n\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.mixer = null;  //混合器\r\n        this.obj = null;\r\n        this.animationAction = null;\r\n        this.clock = new THREE.Clock();\r\n    }\r\n\r\n    loadObj = (data) => {\r\n        var loader = new FBXLoader(); //创建一个FBX加载器\r\n        loader.load(data.objUrl,\r\n            (obj) => {\r\n                this.obj = obj;\r\n                this.display();\r\n                console.log('load fbxobj success:', this.obj);\r\n                this.obj.translateY(-80);\r\n                this.startAnimation();\r\n            },\r\n            (data) => {\r\n                console.log('load fbx obj', data.loaded);\r\n            },\r\n            (e) => {\r\n                console.log('load fbxobj error:', e);\r\n            });\r\n    }\r\n\r\n    display = () => {\r\n        this.scene.add(this.obj);\r\n        var ambient = new THREE.AmbientLight(0xffffff);\r\n        this.scene.add(ambient);\r\n    }\r\n\r\n    remove = () => {\r\n        this.scene.remove(this.obj);\r\n        this.mixer = null;\r\n        this.animationAction = null;\r\n    }\r\n\r\n    startAnimation = () => {\r\n        this.mixer = new THREE.AnimationMixer(this.obj);\r\n        this.animationAction = this.mixer.clipAction(this.obj.animations[0]);\r\n        this.animationAction.play();\r\n    }\r\n\r\n    stopAnimation = () => {\r\n        this.animationAction && this.animationAction.stop();\r\n    }\r\n\r\n    update = () => {\r\n        if (this.mixer) {\r\n            const delta = this.clock.getDelta()  //方法获得两帧的时间间隔\r\n            this.mixer.update(delta);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport default MyFBXLoader;","import * as THREE from 'three';\r\n\r\nclass ObjLoader {\r\n\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.obj = null;\r\n        this.data = null;\r\n    }\r\n\r\n    loadObj = (data) => {\r\n        this.data = data;\r\n        var loader = new THREE.ObjectLoader();\r\n        loader.load(data.objUrl,\r\n            (obj) => {\r\n                this.obj = obj;\r\n                var texture = new THREE.TextureLoader().load(data.texture);\r\n                obj.material = new THREE.MeshBasicMaterial({\r\n                    map: texture,\r\n                });\r\n                this.scene.add(obj);\r\n                obj.scale.set(data.scale, data.scale, data.scale);//网格模型缩放\r\n                obj.geometry.center();//几何体居中\r\n            },\r\n            (data) => { console.log('loading json obj', data.loaded); },\r\n            (e) => { console.log('err', e); }\r\n        )\r\n    }\r\n\r\n    display = () => {\r\n        this.scene.add(this.obj);\r\n    }\r\n\r\n    remove = () => {\r\n        this.scene.remove(this.obj);\r\n        this.mixer = null;\r\n        this.animationAction = null;\r\n    }\r\n\r\n    update = () => {\r\n\r\n    }\r\n}\r\n\r\nexport default ObjLoader;","/**\r\n * 支持向全景场景中心加入可以360°观看的3D模型\r\n */\r\nimport FBXLoader from './loader/FBXLoader';\r\nimport ObjLoader from './loader/ObjLoader';\r\n\r\nclass CenterModelHelper {\r\n\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.modelMap = new Map();\r\n    }\r\n\r\n    loadModelList = (model_list) => {\r\n        model_list && model_list.forEach(data => {\r\n            const loader = this.getLoader(data[1]);\r\n            this.modelMap.set(data[0], loader);\r\n            loader.loadObj(data[1]);\r\n        })\r\n    }\r\n\r\n    loadObj = (data) => {\r\n        this.data = data;\r\n        this.loader = this.getLoader(data);\r\n        this.loader.loadObj(data);\r\n    }\r\n\r\n    display = () => {\r\n        if (!this.loader) return;\r\n        this.loader.display();\r\n    }\r\n\r\n    remove = () => {\r\n        if (!this.loader) return;\r\n        this.loader.remove();\r\n    }\r\n\r\n    startAnimation = () => {\r\n        if (!this.loader) return;\r\n        if (this.data.modeFormat === 'fbx') {\r\n            this.loader.startAnimation();\r\n        }\r\n    }\r\n\r\n    stopAnimation = () => {\r\n        if (!this.loader) return;\r\n        if (this.data.modeFormat === 'fbx') {\r\n            this.loader.stopAnimation();\r\n        }\r\n    }\r\n\r\n    getLoader = (data) => {\r\n        switch (data.modeFormat) {\r\n            case 'fbx':\r\n                return new FBXLoader(this.scene);\r\n            case 'obj':\r\n                return new ObjLoader(this.scene);\r\n            default: return null;\r\n        }\r\n    }\r\n\r\n    update = () => {\r\n        this.modelMap.forEach(data => {\r\n            const loader = data;\r\n            loader.update();\r\n        })\r\n    }\r\n}\r\n\r\nexport default CenterModelHelper;","/**\r\n * 控制全景相机的入场和出场\r\n */\r\nimport TWEEN from '@tweenjs/tween.js';\r\n\r\n\r\nclass CameraMoveAction {\r\n\r\n    constructor(camera, endState, duration = 5000, delay = 1000) {\r\n        this.camera = camera;\r\n        this.tween = null;\r\n        this.onCompleteHandler = null;\r\n        this.onStartHandler = null;\r\n        this.init(endState, duration, delay);\r\n    }\r\n\r\n    init = (endState, duration = 5000, delay = 1000) => {\r\n        const coords = { // Start \r\n            x: this.camera.position.x,\r\n            y: this.camera.position.y,\r\n            z: this.camera.position.z,\r\n            fov: this.camera.fov\r\n        };\r\n        this.tween = new TWEEN.Tween(coords)\r\n            .to({\r\n                x: endState.x,\r\n                y: endState.y,\r\n                z: endState.z,\r\n                fov: endState.fov\r\n            }, duration)\r\n            .delay(delay)\r\n            .easing(TWEEN.Easing.Quadratic.Out)\r\n            .onUpdate(() => {\r\n                this.camera.position.x = coords.x;\r\n                this.camera.position.y = coords.y;\r\n                this.camera.position.z = coords.z;\r\n                this.camera.fov = coords.fov;\r\n                this.camera.updateProjectionMatrix();\r\n            })\r\n            .onStart(() => {\r\n                this.onStartHandler && this.onStartHandler();\r\n            })\r\n            .onComplete(() => {\r\n                this.onCompleteHandler && this.onCompleteHandler();\r\n            });\r\n    }\r\n\r\n    start = () => {\r\n        if (this.tween) {\r\n            this.tween.start();\r\n        }\r\n    }\r\n\r\n    update = () => {\r\n        TWEEN.update();\r\n    }\r\n}\r\n\r\nexport default CameraMoveAction;","/**\r\n * 实现小行星和普通视野等效果的切换\r\n */\r\n\r\nimport CameraMoveAction from './CameraMoveAction';\r\n\r\nclass ViewConvertHelper {\r\n\r\n    constructor(camera, controls) {\r\n        this.camera = camera;\r\n        this.state = null;\r\n        this.controls = controls;\r\n        this.cameraMoveAction = null;\r\n        this.onCompleteHandler = null;\r\n        this.onStartHandler = null;\r\n    }\r\n\r\n    toNormalView = (durtime = 8000, delay = 0) => {\r\n        if (this.state && this.state === 'normal') return;\r\n        this.cameraMoveAction = new CameraMoveAction(this.camera,\r\n            { x: 0, y: 0, z: 100, fov: 80 }, durtime, delay);\r\n        this.cameraMoveAction.onStartHandler = () => {\r\n            this.controls && this.controls.disConnect();\r\n        }\r\n        this.cameraMoveAction.onCompleteHandler = () => {\r\n            this.controls && this.controls.connect();\r\n            this.state = 'planet';\r\n        }\r\n        this.cameraMoveAction.start();\r\n    }\r\n\r\n    toPlanetView = (durtime = 8000, delay = 0) => {\r\n        if (this.state && this.state === 'planet') return;\r\n        this.cameraMoveAction = new CameraMoveAction(this.camera,\r\n            { x: 0, y: 450, z: 0, fov: 150 }, durtime, delay);\r\n        this.cameraMoveAction.onStartHandler = () => {\r\n            this.controls && this.controls.disConnect();\r\n        }\r\n        this.cameraMoveAction.onCompleteHandler = () => {\r\n            this.controls && this.controls.connect();\r\n            this.state = 'planet';\r\n        }\r\n        this.cameraMoveAction.start();\r\n    }\r\n\r\n}\r\n\r\nexport default ViewConvertHelper;","import React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport fscreen from \"fscreen\";\r\n\r\nclass FullScreen extends Component {\r\n    static propTypes = {\r\n        children: PropTypes.node.isRequired,\r\n        enabled: PropTypes.bool.isRequired,\r\n        onChange: PropTypes.func,\r\n    };\r\n\r\n    static defaultProps = {\r\n        enabled: false,\r\n    };\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.detectFullScreen = this.detectFullScreen.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        fscreen.addEventListener(\"fullscreenchange\", this.detectFullScreen);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        fscreen.removeEventListener(\"fullscreenchange\", this.detectFullScreen);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.handleProps(this.props);\r\n    }\r\n\r\n    handleProps(props) {\r\n        const enabled = fscreen.fullscreenElement === this.node;\r\n        if (enabled && !props.enabled) {\r\n            this.leaveFullScreen();\r\n        } else if (!enabled && props.enabled) {\r\n            this.enterFullScreen();\r\n        }\r\n    }\r\n\r\n    detectFullScreen() {\r\n        if (this.props.onChange) {\r\n            this.props.onChange(fscreen.fullscreenElement === this.node);\r\n        }\r\n    }\r\n\r\n    enterFullScreen() {\r\n        if (fscreen.fullscreenEnabled) {\r\n            fscreen.requestFullscreen(this.node);\r\n        }\r\n    }\r\n\r\n    leaveFullScreen() {\r\n        if (fscreen.fullscreenEnabled) {\r\n            fscreen.exitFullscreen();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const className = [\"fullscreen\"];\r\n        if (this.props.enabled) {\r\n            className.push(\"fullscreen-enabled\");\r\n        }\r\n        console.log('fullscreen', this.props.enabled);\r\n\r\n        return (\r\n            <div\r\n                //className={className.join(\" \")}\r\n                ref={node => (this.node = node)}\r\n                style={\r\n                    this.props.enabled ? { height: \"100%\", width: \"100%\" } : undefined\r\n                }\r\n            >\r\n                {this.props.children}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default FullScreen;","/**\r\n * 负责加载纹理资源\r\n * 支持：全景图片，全景视频（flv，hls，mp4格式）\r\n */\r\nimport Hls from 'hls.js';\r\nimport * as THREE from 'three';\r\nimport flvjs from 'flv.js/dist/flv.min.js';\r\n\r\nclass TextureHelper {\r\n\r\n    /**\r\n     * @param {video或者图片的载体} containerNode \r\n     * @param {加载资源的属性集合} resProps \r\n     */\r\n    constructor(containerNode) {\r\n        this.containerNode = containerNode;\r\n        this.onLoadSuccessHandler = null;\r\n        this.onLoadErrorHandler = null;\r\n        this.videoLoader = null;\r\n    }\r\n\r\n    initVideoNode = () => {\r\n        this.containerNode.width = 0;\r\n        this.containerNode.height = 0;\r\n        this.containerNode.loop = true;\r\n        this.containerNode.muted = true;\r\n        this.containerNode.crossOrigin = \"anonymous\"\r\n        this.containerNode.setAttribute('webkit-playsinline', 'webkit-playsinline');\r\n    }\r\n\r\n    getTextureFromVideo = (video) => {\r\n        let texture = new THREE.VideoTexture(video);\r\n        texture.minFilter = THREE.LinearFilter;\r\n        texture.format = THREE.RGBFormat;\r\n        return texture;\r\n    }\r\n\r\n    loadFlvVideo = (resUrl) => {\r\n        this.initVideoNode();\r\n        if (flvjs.isSupported()) {\r\n            let flvPlayer = flvjs.createPlayer({ type: 'flv', url: resUrl });\r\n            this.videoLoader = flvPlayer;\r\n            flvPlayer.attachMediaElement(this.containerNode);\r\n            flvPlayer.load();\r\n            flvPlayer.play();\r\n        } else {\r\n            console.error('Your browser does not support flvjs')\r\n            this.onLoadErrorHandler('设备不支持FLV');\r\n        }\r\n        return this.getTextureFromVideo(this.containerNode);\r\n    }\r\n\r\n    loadHlsVideo = (resUrl) => {\r\n        this.initVideoNode();\r\n        if (Hls.isSupported()) {\r\n            var hls = new Hls();\r\n            this.videoLoader = hls;\r\n            hls.loadSource(resUrl);\r\n            hls.attachMedia(this.containerNode);\r\n            hls.on(Hls.Events.MANIFEST_PARSED, () => {\r\n                this.containerNode.play();\r\n                this.onLoadSuccessHandler();\r\n            });\r\n        } else {\r\n            console.log('设备不支持HLS')\r\n            this.onLoadErrorHandler('设备不支持HLS');\r\n        }\r\n        return this.getTextureFromVideo(this.containerNode);\r\n    }\r\n\r\n    loadMp4Video = (resUrl) => {\r\n        this.initVideoNode();\r\n        this.containerNode.src = resUrl;\r\n        this.containerNode.load();\r\n        this.containerNode.play();\r\n        return this.getTextureFromVideo(this.containerNode);\r\n    }\r\n\r\n    loadImage = (resUrl) => {\r\n        var texture = new THREE.TextureLoader().load(resUrl);\r\n        return texture;\r\n    }\r\n\r\n    loadTexture = (resource) => {\r\n        const { type, res_url } = resource;\r\n        switch (type) {\r\n            case 'hls':\r\n                return this.loadHlsVideo(res_url);\r\n            case 'flv':\r\n                return this.loadFlvVideo(res_url);\r\n            case 'mp4':\r\n                return this.loadMp4Video(res_url);\r\n            case 'image':\r\n                return this.loadImage(res_url);\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    unloadFlvVideo = () => {\r\n        if (this.videoLoader) {\r\n            this.videoLoader.unload();\r\n            this.videoLoader.detachMediaElement();\r\n        }\r\n    }\r\n\r\n    unloadHlsVideo = () => {\r\n        if (this.videoLoader) {\r\n            this.videoLoader.destory();\r\n        }\r\n    }\r\n}\r\n\r\nexport default TextureHelper;","import React, { Component } from 'react';\r\nimport * as THREE from 'three';\r\nimport { connect } from 'react-redux'\r\nimport { fetchLiveConfigure } from './redux/basic.redux';\r\nimport InnerViewControls from './controls/InnerViewControls';\r\nimport SpriteShapeHelper from './display/SpriteShapeHelper';\r\nimport EffectContainer from './effect/EffectContainer';\r\nimport CenterModelHelper from './display/CenterModelHelper';\r\nimport TWEEN from '@tweenjs/tween.js';\r\nimport ViewConvertHelper from './action/ViewConvertHelper';\r\nimport FullScreen from './utils/fullscreen';\r\nimport TextureHelper from './texture/TextureHelper';\r\nimport Proptypes from 'prop-types';\r\nimport './App.css';\r\n\r\nclass XRPlayer extends Component {\r\n\r\n  state = {\r\n    showingEffect: false,\r\n    effectData: null,\r\n    isFullScreen: false\r\n  }\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.mount = null;\r\n    this.scene = null;\r\n    this.camera = null;\r\n    this.renderer = null;\r\n    this.controls = null;\r\n    this.sceneContainer = null;\r\n\r\n    this.innerView = true; // 是否是内视角\r\n    this.innerViewControls = null;\r\n    this.spriteShapeHelper = null;\r\n    this.centerModelHelper = null;\r\n    this.viewConvertHelper = null;\r\n    this.spriteData = null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.initScene();\r\n    this.initCamera();\r\n    this.initEvent();\r\n    this.initControls();\r\n    this.animate();\r\n    this.initDisplay();\r\n    this.initRenderer();\r\n    this.initAction();\r\n    //TODO test redux \r\n    this.props.fetchLiveConfigure();\r\n  }\r\n\r\n  initCamera = () => {\r\n    const {\r\n      camera_fov, camera_far, camera_near,\r\n      camera_position: position, camera_target: target\r\n    } = this.props;\r\n    const camera = new THREE.PerspectiveCamera(\r\n      camera_fov, this.mount.clientWidth / this.mount.clientHeight,\r\n      camera_near, camera_far);\r\n    const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n    this.renderer = renderer;\r\n    camera.position.set(position.x, position.y, position.z);\r\n    camera.target = new THREE.Vector3(target.x, target.y, target.z);\r\n    this.camera = camera;\r\n  }\r\n\r\n  initScene = () => {\r\n    const {\r\n      scene_texture_resource: textureResource,\r\n      axes_helper_display: isAxesHelperDisplay\r\n    } = this.props;\r\n    let geometry = new THREE.SphereGeometry(500, 60, 40); // 球体\r\n    geometry.scale(-1, 1, 1);\r\n    const textureHelper = new TextureHelper(this.sceneContainer);\r\n    let texture = textureHelper.loadTexture(textureResource);\r\n    let material = new THREE.MeshBasicMaterial({ map: texture });\r\n    let mesh = new THREE.Mesh(geometry, material);\r\n    this.scene = new THREE.Scene();\r\n    this.scene.add(mesh);\r\n    if (isAxesHelperDisplay) {\r\n      let axisHelper = new THREE.AxesHelper(1000)//每个轴的长度\r\n      this.scene.add(axisHelper);\r\n    }\r\n  }\r\n\r\n  initEvent = () => {\r\n    window.addEventListener('resize', this.onWindowResize, false);\r\n  }\r\n\r\n  initDisplay = () => {\r\n    const { event_list, hot_spot_list } = this.props;\r\n    this.spriteData = new Map(event_list);\r\n    this.spriteShapeHelper = new SpriteShapeHelper(this.scene, this.camera);\r\n    this.spriteShapeHelper.setPointList(hot_spot_list);\r\n    this.spriteShapeHelper.objectClickHandler = (intersects) => {\r\n      const key = intersects[0].object.name;\r\n      if (this.spriteData.has(key)) {\r\n        this.setState({\r\n          showingEffect: true,\r\n          effectData: this.spriteData.get(key)\r\n        });\r\n      }\r\n      console.log(intersects[0].object.name);\r\n    }\r\n\r\n    const { model_list } = this.props;\r\n    this.centerModelHelper = new CenterModelHelper(this.scene);\r\n    this.centerModelHelper.loadModelList(model_list);\r\n  }\r\n\r\n  initAction = () => {\r\n    this.viewConvertHelper = new ViewConvertHelper(this.camera, this.innerViewControls);\r\n    this.innerViewControls && this.innerViewControls.disConnect();\r\n    this.viewConvertHelper.toNormalView(8000, 2000);\r\n  }\r\n\r\n  onWindowResize = () => {\r\n    this.camera.aspect = window.innerWidth / window.innerHeight;\r\n    this.camera.updateProjectionMatrix();\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n  }\r\n\r\n  initRenderer = () => {\r\n    const renderer = this.renderer;\r\n    renderer.setPixelRatio(window.devicePixelRatio);\r\n    renderer.setSize(window.innerWidth, window.innerHeight);\r\n    renderer.sortObjects = false;\r\n    renderer.autoClear = false;\r\n    this.mount.appendChild(renderer.domElement);\r\n  }\r\n\r\n  animate = () => {\r\n    requestAnimationFrame(this.animate);\r\n    if (this.innerView) {\r\n      this.innerViewControls && this.innerViewControls.update();\r\n    } else {\r\n      this.controls.update();\r\n    }\r\n    if (this.centerModelHelper) {\r\n      this.centerModelHelper.update();\r\n    }\r\n    TWEEN.update(); // 不要轻易去掉，渐变动画依赖该库\r\n    this.renderer.render(this.scene, this.camera);\r\n  }\r\n\r\n  initControls = () => {\r\n    this.innerViewControls = new InnerViewControls(this.camera);\r\n    this.innerViewControls.connect();\r\n\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.mount.removeChild(this.renderer.domElement)\r\n  }\r\n\r\n  render() {\r\n    // TODO test redux state\r\n    console.log('redux.data.live_configure', this.props.live_configure);\r\n    return (\r\n      <FullScreen\r\n        enabled={this.state.isFullScreen}\r\n        onChange={isFull => this.setState({ isFullScreen: isFull })}\r\n      >\r\n        <div\r\n          style={{\r\n            width: '100vw', height: '100vh',\r\n            background: '#888', overflow: \"hidden\"\r\n          }}\r\n        >\r\n          <div\r\n            id=\"canvas\"\r\n            style={{ width: '100%', height: '100%', background: '#888' }}\r\n            ref={(mount) => { this.mount = mount }}\r\n          >\r\n          </div>\r\n          {\r\n            this.state.showingEffect ?\r\n              <EffectContainer\r\n                data={this.state.effectData}\r\n                onCloseClickHandler={() => {\r\n                  this.setState({\r\n                    effectData: null\r\n                  })\r\n                }}\r\n              ></EffectContainer>\r\n              :\r\n              \"\"\r\n          }\r\n          <video id=\"video\"\r\n            style={{ display: \"none\" }}\r\n            ref={(mount) => { this.sceneContainer = mount }} >\r\n          </video>\r\n          <div\r\n            id=\"display\"\r\n            style={{ display: \"none\" }}>\r\n          </div>\r\n        </div>\r\n      </FullScreen >\r\n    );\r\n  }\r\n}\r\n\r\nXRPlayer.protoTypes = {\r\n  camera_fov: Proptypes.number,\r\n  camera_near: Proptypes.number,\r\n  camera_far: Proptypes.number,\r\n  camera_position: Proptypes.object,\r\n  camera_target: Proptypes.object,\r\n  scene_texture_resource: Proptypes.object,\r\n  axes_helper_display: Proptypes.bool,\r\n  hot_spot_list: Proptypes.array,\r\n  event_list: Proptypes.array\r\n}\r\n\r\nXRPlayer.defaultProps = {\r\n  camera_fov: 150,\r\n  camera_near: 0.01,\r\n  camera_far: 10000,\r\n  camera_position: {\r\n    x: 0,\r\n    y: 450,\r\n    z: 0\r\n  },\r\n  camera_target: {\r\n    x: 0,\r\n    y: 0,\r\n    z: 0\r\n  },\r\n  scene_texture_resource: {\r\n    type: 'hls',\r\n    res_url: 'http://cache.utovr.com/s1e3tzoku70yk8mpa3/L3_5dxsrk4kh56gc4l1_v2.m3u8',\r\n    // type: 'image',\r\n    // res_url: 'https://pic-cloud-bupt.oss-cn-beijing.aliyuncs.com/5c882ee6443a5.jpg'\r\n  },\r\n  axes_helper_display: true,\r\n  hot_spot_list: [\r\n    ['infocard', { phi: -90, theta: -10, res_url: 'hotspot_video.png' }],\r\n    ['image', { phi: 32, theta: 14, res_url: 'hotspot_video.png' }],\r\n    ['video', { phi: -153, theta: -44, res_url: 'hotspot_video.png' }],\r\n    ['control', { phi: 67, theta: 19, res_url: 'hotspot_video.png' }]\r\n  ],\r\n  event_list: [\r\n    ['infocard', {\r\n      id: 'infocard',\r\n      type: 'infocard',\r\n      iframeUrl: \"https://gs.ctrip.com/html5/you/place/14.html\"\r\n    }],\r\n    ['image', {\r\n      id: 'image',\r\n      type: 'image',\r\n      imageUrl: \"https://pic-cloud-bupt.oss-cn-beijing.aliyuncs.com/5c882ee6443a5.jpg\",\r\n      jumpUrl: 'http://www.youmuvideo.com',\r\n    }],\r\n    ['video', {\r\n      id: 'video',\r\n      type: 'video',\r\n      videoUrl: 'https://video-cloud-bupt.oss-cn-beijing.aliyuncs.com/hangzhou.mp4'\r\n    }],\r\n    ['control', {\r\n      id: 'control',\r\n      type: 'control',\r\n    }]\r\n  ],\r\n  model_list: [\r\n    ['12332', {\r\n      objUrl: \"SambaDancing.fbx\",\r\n      texture: \"texture1.png\",\r\n      modeFormat: \"fbx\",\r\n      scale: 1\r\n    }],\r\n    ['23433', {\r\n      objUrl: \"model.json\",\r\n      texture: \"texture1.png\",\r\n      modeFormat: \"obj\",\r\n      scale: 1\r\n    }]\r\n  ]\r\n}\r\n\r\nexport default connect(\r\n  state => state.basic,\r\n  { fetchLiveConfigure }\r\n)(XRPlayer);","import { combineReducers } from 'redux';\r\nimport { basic } from './redux/basic.redux';\r\nconst rootReducer = combineReducers({\r\n    basic\r\n});\r\nexport default rootReducer;","import { createStore, applyMiddleware, compose } from 'redux';\r\nimport thunk from 'redux-thunk';        // 中间件，用来处理异步数据\r\nimport rootReducer from './reducer';\r\n\r\nconst store = createStore(\r\n    rootReducer,\r\n    compose(\r\n        applyMiddleware(thunk),\r\n        window.devToolsExtension ? window.devToolsExtension() : f => f\r\n    )\r\n);\r\nexport default store;\r\n","import React from 'react';\r\nimport './index.css';\r\nimport Player from './Player';\r\nimport { Provider } from 'react-redux' // https://react-redux.js.org/api/connect\r\nimport store from './store';\r\n\r\nclass XRPlayer extends React.Component {\r\n    render() {\r\n        return (\r\n            <Provider store={store}>\r\n                <Player />\r\n            </Provider>\r\n        )\r\n    }\r\n}\r\n\r\nexport default XRPlayer;\r\n\r\n","import React from 'react';\r\n//import XRPlayer from '../../lib/index';\r\nimport XRPlayer from '../../src/index';\r\n//import XRPlayer from 'react-xrplayer'\r\nconsole.log('xrplayer', XRPlayer);\r\nclass App extends React.Component {\r\n\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <XRPlayer></XRPlayer>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default App;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './app';\r\n\r\n\r\nReactDOM.render(\r\n    <App />,\r\n    document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\n"],"sourceRoot":""}